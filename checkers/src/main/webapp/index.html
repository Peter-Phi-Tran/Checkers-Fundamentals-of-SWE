<html>
<!-- <div "new_account"></div>
    new account -->

<head>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="join_game.js"></script>
</head>

<!-- <div "join_game"> -->
<div class="lobby_lists_container">
    <h2>Welcome back {playerID} Have fun in the lobby :D</h2>
    <p>Current players: 3/48</p>
    <div class="lobby_lists" style="border-radius: 2em; border: 1px solid">
        <ol id="lobby_list_items">
            <!-- Dynamically Created Elements -->

            <!-- EXAMPLE:
            <li class="player">
                <p id="#UID002"> Player 2 - {ELO} <span class="status busy"></span></p>
                <button><a id="btn1-UID002" type="button" href="" onclick="req_challenge(1,2)">Challenge</a></button>
                <button><a id="btn2-UID002" type="button" href="">View Match</a></button>
            </li> -->
        </ol>
    </div>

    <button>
        <a id="CURRENT_SESSION_JQ" type="button" onclick="match_making({'id':1,'name':'bob','elo':1200})">
            Match Making
        </a>
    </button>
    <button>
        <a id="CURRENT_SESSION_BOT" type="button">
            Request Bot
        </a>
    </button>
    <button>
        <a id="CURRENT_SESSION_BOTvsBOT" type="button">
            Watch Bot Vs Bot
        </a></button>
</div>


</div>

<!-- <div "game_display"></div>
    game display
    <div "summary"></div>
    summary -->

</html>
<script>
    // each of the 'divs' in the html page should have attributes to allow them to be hidden.
    // the page manager should send a small json message, that tells which of these are hidden
    // and which are visible when there is a change
    // something like "{"display_new_account":t,"display_join_game":f,"display_game_display:f,"display_summary":f}"


    // a reminder.  we want to create one websocket connection, and use if, basically forever.
    // or until the user decides to go to another page.
    // this requires everything to load from this page.

    var connection = null;

    var serverUrl;
    serverUrl = "ws://" + window.location.hostname + ":" + (parseInt(location.port) + 100);
    connection = new WebSocket(serverUrl);

    connection.onopen = function (evt) {
        console.log("open");
    }

    connection.onclose = function (evt) {
        console.log("close");
    }

    connection.onmessage = (event) => {
        const users = JSON.parse(event.data);
        const listEl = document.getElementById("lobby_list_items");


        for (const userKey in users) {
            const user = users[userKey];
            console.log(user); 
            const li = document.createElement("li");
            li.className = "player"; 

            // create player info
            const para = document.createElement("p")
            para.innerText = `${user.username} (ID: ${parseInt(user)})`;
            para.style.fontSize = "17px"; // Set font size for the player info
            para.id = `UID${parseInt(user)}`; 

            const statusSpan = document.createElement("span");
            statusSpan.className = "status free"; 

            para.appendChild(statusSpan); 

            // Create buttons button
            const challenge_btn = document.createElement("button");
            const challenge_btn_link = document.createElement("a");

            challenge_btn_link.id = `btn1-${parseInt(user)}`; 
            challenge_btn_link.type = "button";
            challenge_btn_link.href = "#";
            challenge_btn_link.innerText = "Challenge";

            challenge_btn_link.onclick = function() { 
                req_challenge(1, parseInt(user)); 
                return false; 
            };
            
            const view_btn = document.createElement("button");
            const view_btn_link = document.createElement("a");
            
            view_btn_link.id = `btn2-${parseInt(user)}`;
            view_btn_link.type = "button";
            view_btn_link.href = "#";
            view_btn_link.innerText = "View Match"; 
            
            challenge_btn.appendChild(challenge_btn_link); 
            view_btn.appendChild(view_btn_link); 
            
            //send info to server using socket.send, do have to update the Id and im not sure if you guys prefer sending the whole list or just 1 player info at a time

            challenge_btn.addEventListener("click", () => {
                const payload = {
                    userID: user.ID,
                    action: "do_something",
                    username: user.username,
                };
                socket.send(JSON.stringify(payload));
                console.log("Sent:", payload);
            });
            
            li.appendChild(para); 
            li.appendChild(challenge_btn);
            li.appendChild(view_btn);
            listEl.appendChild(li);
        }
    };
    /**
     * [This function take in player id 1, player id 2 and then send back to server to signal a challenge request]
     */
    function req_challenge(id1, id2) {
        //do same handling here 
        alert(`${id1} request challenge ${id2}`);
    }

    /**
     * [This function take in player id 1, player id 2 and then send back to server to signal a view match request]
     */
    function req_viewmatch(id1, id2) {
        //do same handling here , playerid1 want to view playerid2 match

        alert(`${id1} request view ${id2}`);
    }

    /**
     * [This function take in current client and send signal to server indicating bot request]
     */
    function req_bot(id1) {
        alert(`${id1} request bot`);
    }

    /**
     * [This function take in current client json and signal to server indicating matchmaking request]
     */
    function match_making(player1) {
        const message = {
            'message_type': 'match_making',
            'player': {
                'id1': player1.id1,
                'name': player1.name,
                'elo': player1.elo
            }
        };
        alert(JSON.stringify(message, null, 2)); // Converts the object to a readable JSON string
    }

    class UserEvent {
        msg;
    }

    function msg() {
        console.log("button clicked");
        U = new UserEvent();
        U.msg="i pushed a button";
        connection.send(JSON.stringify(U));
        console.log(JSON.stringify(U))
    }

	function summary(/*void*/)
	{
		/*
		 * This function requests a player-json-object from pageMrg for the current player as well as the top 10 ranked players 
		 * (See ./INTERFACES/player-json-schema.md) via methods `retrieveUserJson` and `retrieveTopTenJson`.
		 * This data is then written to the html table in the summary div
		 * 
		 * TODO: Need to get uuid of current session to call `retrieveUserJson`
		 */
		
		// playerData = retreiveUserJson();
		// globalData = retrieveTopTenJson();

		// Write top ten to table
		// write user to table
		return;

	}
</script>
