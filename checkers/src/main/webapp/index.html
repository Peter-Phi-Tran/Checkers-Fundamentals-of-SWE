<html>
    <!-- <div "new_account"></div>
    new account -->

    <head>
        <link rel="stylesheet" type="text/css" href="styles.css">
        <script src="join_game.js"></script>
    </head>

    <!-- <div "join_game"> -->
        <div class="lobby_lists_container">
            <h2>Welcome back {playerID} Have fun in the lobby :D</h2>
            <p>Current players: 3/48</p> 
            <div class="lobby_lists" style="border-radius: 2em; border: 1px solid">
                <ol>
                    <li class="player">
                        <p id="#UID001"> Player 1 - {ELO}</p>

                        <button><a id="btn1-UID001" type="button" href="">Challenge</a></button>
                        <button><a id="btn2-UID001" type="button" href="">View Match</a></button>
                    </li>

                    <li class="player">
                        <p id="#UID002"> Player 2 - {ELO}</p>
                        <button><a id="btn1-UID002" type="button" href="">Challenge</a></button>
                        <button><a id="btn2-UID002" type="button" href="">View Match</a></button>
                    </li>
                </ol>
            </div>

            <button>
                <a id="CURRENT_SESSION_JQ" type="button">
                    Match Making
                </a>
            </button>
            <button>
                <a id="CURRENT_SESSION_BOT" type="button">
                    Request Bot
                </a>
            </button>
            <button>
                <a id="CURRENT_SESSION_BOTvsBOT" type="button">
                    Watch Bot Vs Bot
                </a></button>
        </div>
        

    </div>

    <!-- <div "game_display"></div>
    game display
    <div "summary"></div>
    summary -->

</html>
<script>
    // each of the 'divs' in the html page should have attributes to allow them to be hidden.
    // the page manager should send a small json message, that tells which of these are hidden
    // and which are visible when there is a change
    // something like "{"display_new_account":t,"display_join_game":f,"display_game_display:f,"display_summary":f}"


    // a reminder.  we want to create one websocket connection, and use if, basically forever.
    // or until the user decides to go to another page.
    // this requires everything to load from this page.

    var connection = null;

    var serverUrl;
    serverUrl = "ws://" + window.location.hostname + ":" + (parseInt(location.port) + 100);
    connection = new WebSocket(serverUrl);

    connection.onopen = function (evt) {
        console.log("open");
    }

    connection.onclose = function (evt) {
        console.log("close");
    }

    connection.onmessage = (event) => {
            const users = JSON.parse(event.data);
            const listEl = document.getElementById("lobby_list");


            for (const userKey in users) {
                const user = users[userKey];

                // Create list item
                const li = document.createElement("li");
                li.innerText = `${user.username} (ID: ${user.ID})`;

                // Create action button
                const btn = document.createElement("button");
                btn.innerText = "Send Event";

                //send info to server using socket.send, do have to update the Id and im not sure if you guys prefer sending the whole list or just 1 player info at a time

                btn.addEventListener("click", () => {
                    const payload = {
                        userID: user.ID,
                        action: "do_something",
                        username: user.username,
                    };
                socket.send(JSON.stringify(payload));
                console.log("Sent:", payload);
            });

            li.appendChild(btn);
            listEl.appendChild(li);
        }
    };

    class UserEvent {
        msg;
    }

    function msg() {
        console.log("button clicked");
        U = new UserEvent();
        U.msg="i pushed a button";
        connection.send(JSON.stringify(U));
        console.log(JSON.stringify(U))
    }

	function summary(/*void*/)
	{
		/*
		 * This function requests a player-json-object from pageMrg for the current player as well as the top 10 ranked players 
		 * (See ./INTERFACES/player-json-schema.md) via methods `retrieveUserJson` and `retrieveTopTenJson`.
		 * This data is then written to the html table in the summary div
		 * 
		 * TODO: Need to get uuid of current session to call `retrieveUserJson`
		 */
		
		// playerData = retreiveUserJson();
		// globalData = retrieveTopTenJson();

		// Write top ten to table
		// write user to table
		return;

	}
</script>
